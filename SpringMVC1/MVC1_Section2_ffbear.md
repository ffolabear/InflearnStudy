# 스프링 MVC 1편 - 백엔드 웹 개발 핵심 기술
_강의를 듣고 강의 내용을 기반으로 작성하였습니다._

<br>

## 웹 애플리케이션 이해

<br>

### 웹 서버, 웹 애플리케이션 서버

웹은 HTTP 를 기반으로 통신한다. HTTP 로는 다음과 같은 것들을 전송할 수 있다.  

- HTML, TEXT
- IMAGE, 음성, 영상, 파일
- JSON, XML (API)
- 거의 모든 형태의 데이터 전송 가능 
- 서버간에 데이터를 주고 받을 때도 대부분 HTTP 사용


이런자료들은 서버를 통해서 전송하는데 크게 웹서버와 웹 애플리케이션 서버(WAS) 가 존재한다.

<br>

#### 웹서버
- 정적 리소스 제공                                     
    - HTML, CSS, JS, 이미지, 영상
- ex) NGINX, APACHE

<br>

#### WAS 
- 웹 서버 기능 포함+ (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행
    - 동적 HTML, HTTP API(JSON)
    - 블릿, JSP, 스프링 MVC
- 자바는 서블릿 컨테이너 기능을 제공하면 WAS
- ex) 톰캣(Tomcat) Jetty, Undertow

<br>

사실 둘의 경계는 모호하지만 서버의 역할을 구분해놓은 것이다.   
한마디로, **웹서버는 정적 리소스, WAS 는 애플리케이션 로직 수행**


<br>
<hr>

### 서블릿(Servlet)

<br>

HTTP 로 서버와 통신하기 위해서는 많은 작업이 필요하다. 

- 서버 TCP/IP 연결 대기, 소켓 연결 
- HTTP 요청 메시지를 파싱해서 읽기 POST 방식, /save URL 인지 
- Content-Type 확인
- HTTP 메시지 바디 내용 파싱
  - username, age 데이터를 사용할 수 있게 파싱
- 저장 프로세스 실행
- 비즈니스 로직 실행
  - 데이터베이스에 저장 요청
- HTTP 응답 메시지 생성시작
  - HTTP 시작 라인 생성
  - Header 생성
  - 메시지 바디에 HTML 생성에서 입력
- TCP/IP에 응답 전달, 소켓 종료

<br>

서블릿은 HTTP 요청정보를 사용할수 있는 `HttpServletRequest`, 응답 정보를 편리하게 제공할 수 있는 `HttpServletResponse`
를 제공하 때문에 많은 부분을 대신 해주기 때문에 개발자는 비즈니스로직에만 집중할 수 있다.


### 동시 요청 - 멀티 쓰레드

<br>

애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드라고 하는데 이 쓰레드가 서블릿을 호출한다. 

요청이 들어오면 쓰레드를 생성해서 실행하는데 이렇게 요청이 올때마다 쓰레드를 생성하면 장단점이 있는데,

#### 장점
- 동시 요청을 처리할 수 있다.
- 리소스(CPU, 메모리)가 허용할 때 까지 처리가능
- 하나의 쓰레드가 지연 되어도, 나머지 쓰레드는 정상 동작한다.


#### 단점
- 쓰레드는 생성 비용은 매우 비싸다.
  - 고객의 요청이 올 때 마다 쓰레드를 생성하면, 응답 속도가 늦어진다.
- 쓰레드는 컨텍스트 스위칭 비용이 발생한다.
- 쓰레드 생성에 제한이 없다.
  - 고객 요청이 너무 많이 오면, CPU, 메모리 임계점을 넘어서 서버가 죽을 수 있다.
  
<br>

이런점들을 보완하기 위해 WAS 들은 `쓰레드풀` 이라는 것을 사용한다.
- 쓰레드풀에는 미리 만들어 놓은 쓰레드들이 보관, 관리된다.
- 쓰레드가 필요할때 쓰레드풀에 요청하면 쓰레드를 꺼내서 반환하고 사용이 끝나면 반환한다.
- 일정 수치만큼의 쓰레드만 보관되고 그 수치를 넘었을때 요청은 거절하거나 대기 시킨다.
  - 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리할 수 있다.
- 미리 생성된 양만큼의 쓰레드를 사용하므로 쓰레드를 생성하고 종료하는 비용(CPU)이 절약되고, 응답 시간이 빠르다.

<br>

WAS 의 최대 튜닝 포인트는 최대 쓰레드(max thread) 수인데, **이 값이 너무 낮으면 클라이언트의 응답이 지연되고 너무 높으면 CPU의 성능을 넘어서기 때문에 
서버가 다운될수가 있다.** 결국 적정 수치만큼 정하는것인데 이것은 서비스의 DB 조회 횟수 같은 서비스의 비즈니스 로직의 복잡도에 따라 다르기 때문에 테스트를 통해 
유연하게 결정해야한다. **멀티쓰레드는 WAS 가 지원해준다**.

<br>
<hr>

### HTML, HTTP API, CSR, SSR

<br>

- 정적리소스를 전달할때는 일반적안 HTML 로 제공한다.   
- 동적인 HTML 페이지는 WAS 가 JSP, 타임리프를 통해서 **HTML을 동적으로 생성한다.**  
- HTML이 아니라 데이터를 전달할때가 있는데, 이때는 JSON 형식으로 데이터를 보낸다.
  - 이 JSON 을 주고받을떄 HTTP API 를 사용한다.
    - 웹 클라이언트 ↔️ 서버
    - 앱 클라이언트 ↔️ 서버
    - 서버 ↔️ 서버
  
그래서 백엔드 개발자가 고민해야하는 3가지가 위의 경우다.


1. 정적 리소스를 어떻게 제공할 것인가
2. 동적으로 생성되는 페이지를 어떻게 재공할 것인가
3. HTTP API 어떻게 제공할 것인가

<br>

#### SSR - Server Side Rendering

<br>

- HTML 최종 결과를 서버에서 만들어서 웹 브라우저에 전달
- 주로 정적인 화면에 사용
- 관련기술: JSP, 타임리프 -> **백엔드 개발자**


<br>

#### CSR - Client Side Rendering
- HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적으로 생성해서 적용 
- 주로 동적인 화면에 사용, 웹 환경을 마치 앱 처럼 필요한 부분부분 변경할 수 있음 
- 예) 구글 지도, Gmail, 구글 캘린더
- 관련기술: React, Vue.js -> **웹 프론트엔드 개발자**



<br><br>
